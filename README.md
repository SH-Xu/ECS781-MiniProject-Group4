# RESTful API for Personal Reading List

The project provides python flask RESTful API for building a personal reading list. It uses external RESTful service to complement its functionality.

The external API comes from OpenLibrary.

https://openlibrary.org/dev/docs/api/books


## 1. Basic Task

### 1.1 External API

```
@app.route("/detail/<type>/<index>")
```
This api interacts with external Openlibrary api. It provided the detail of a book on Openlibrary based on the identity number of a book.

Parameter \<type\> is for type of identity number.According to document, it currently support 4 type, including ISBN, OCLC, LCCN, OLID. Parameter \<index\> is the identity number.

### 1.2 External Cloud Database

In this project, we choose MongoDB for persisting information. MongoDB is a popular NoSQL database, the basic unit of MongoDB is document. It is flexibale and ideal for persisting json. 

#### 1.2.1 MongoDB Set Up

Simply pull docker image for MongoDB

```
docker pull mongo
```

Build container and run the service

```
docker create -it --name MongoTest -p 5000:27017 mongo
```

Here we map the port of mongoDB service from 27017 to 5000.

#### 1.2.2 Implement Interface In Python

Four different kinds of HTTP request corresponding to four operations on database. Interface including ```read```, ```write```, ```update```, ```delete``` methods.

Detail implements are included in mongoDB.py

### 1.3 CURD Operations

Test for REST api will be carried out using postman. In each section, the body of the request will be shown.

#### 1.3.1 POST
Request Body:
```
{
    "database": "books",
    "collection": "read",
    "Document": {
        "Title": "Book1",
        "Author": "Author1",
        "Description": "This is Book1"
    }
}
```
```database```: Assign which database to use.

```collection```: Assign which collection to use.
If the database or collection doesn't exsist, it will be created automatically.

```Document```: The information will be insertedo into the database.

Response Body:
```
{
    "Status": "Sucessfully Inserted",
    "Document_ID": "606a49eecc9d19d8cdbb6e94"
}
```

It returns the status and unique id generated by database.
#### 1.3.2 GET
Request Body:
```
{
    "database": "books",
    "collection": "read"
}
```
Response Body:
```
[
    {
        "Title": "Book1",
        "Author": "Author1",
        "Description": "This is Book1"
    }
]
```
#### 1.3.3 PUT
Request Body:
```
{
    "database": "books",
    "collection": "read",
    "Filter":{
        "Title":"Book1"
    },
    "DataToBeUpdated":{
        "Description": "This is more than a book",
        "Modefied Date": "Today"
    }
}
```

```Filter```: Identify which document to be modefied.

```DataToBeUpdated```: The new data that apply to the selected document.


Response Body:
```
{
    "Status": "Successfully Update"
}
```

To justify the PUT request actually worked, use GET request again.

Response Body:
```
[
    {
        "Title": "Book1",
        "Author": "Author1",
        "Description": "This is more than a book",
        "Modefied Date": "Today"
    }
]
```

#### 1.3.4 DELETE
Request Body:
```
{
    "database": "books",
    "collection": "read",
    "Filter": {
        "Title": "Book1"
    }
}
```

Reponse Body:

```
{
    "Status": "Successfully Deleted"
}
```

## 2. Adavanced Task

### 2.1 HTTPS Implementation

To setup HTTPS service, first run the following command

```
openssl req -x509 -newkey rsa:4096 -nodes -out cert.pem -keyout key.pem -days 365
```

Modify app.py to run service over HTTPS.

```
if __name__ == "__main__":
            context = ('cert.pem','key.pem')
            app.run(host='0.0.0.0', 
                    port=5001, 
                    ssl_context=context
                    )

```

Now the service can be accessed throught HTTPS.

### 2.2 Hash-Based Authentication

A complete hash-based authentication includes two stage.

#### 2.2.1 Apply for an unique token

```
@app.route("/apply_token", methods=["POST", "GET"]) 
```

Here, we allow application through POST or GET method. After requeset is sent, flask would return an unique token. Authentication use Basic Auth.

#### 2.2.2 Login through token

```
@app.route("/login", methods=["POST", "GET"]
```

To successfuly login, the token which just applied should be added to params of the request. The query params should include a key named ```token``` and value is token.

### 2.3 User Accounts And Access Management

In most situations, only administration account has the authority to write and delete. Besides, other user accounts can only read records.

This functionality is implemented by assign a ```Authority_status``` value to decided the access of current user. ```Administrator``` is the user name of administration account.
